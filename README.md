# React internals

### СОДЕРЖАНИЕ
- [краткая суть](#краткая-суть)
- [определения](#определения)
- [мысли](#мысли)
### КРАТКАЯ СУТЬ

### ОПРЕДЕЛЕНИЯ
  Реконсилиация
  FiberRoot - механизм переключения между current & workInProgress tree
  RootFiber - аналог document, также известен как HostRoot, корневая нода fiber дерева
  fiber - нить, виртуальый DOM, состоящий из fiberNode
  fiberNode - элемент вирутального DOM
  StateNode
  children - в контексте реального DOM дерева, вложенные теги первого уровня (прямые потомки)
  child - в контексте реального DOM дерева, все узлы первого уровня, включая комменты, текстовые узлы и т.д.
  tag - тип fiberNode

### МЫСЛИ

есть 4 дерева
  - дерево реакт элементов
  - дерево fiber current
  - дерево fiber workInProgress
  - дерево DOM

у DOM узла есть добалвенные свойства от react. Они соедржат
  - соответствующую fiber node
  - события, которые были приреплены к DOM узлу самим реактом

div#root специально как-то помечается реактом. Возможно для отслеживание
его уникальности.

Перед отрисовкой приложения в div#root этот div#root вычищается от 
внутреннего содержимого, включая и children и childs

Есть tag, который собой представляет тип fiber node. 

Fiber root создается двумя частями. RootFiber(HostRoot, tag: 3) & FiberRoot. Они повязываются через свойства FiberRoot.current = RootFiber & RootFiber.stateNode = FiberRoot.

Содержимое FiberNode больше, чем содержимое ReactElement.

Много константных вспомогатедбных значений расположено в замыкании.

Чтобы понимать код реакта, надо познакомиться с пониманием бинарных операций.

Увидели процесс создания корня файберового дерева, на него потом насадятся листики, а потом эта структура уйдет на отрисовку реальным домом. 

В реакте часто видим применение побитовых операторов, это уведичивается производительность. Т.к. побитовые операторы малоинформативны, они именованы понятными константами на английском языке. подробнее тыкать [сюда](https://learn.javascript.ru/bitwise-operators). 

В процессе debugger Chrome есть разные управляющие стрелки:
- F9 (step), шаг машинного выполнения/логики (с учетом асинхронности)
- F11 (Step into), углубиться во вложенную функцию
- Shift + F11 (Step out), выйти из вложенной функции
- F10 (Step over), идти по коду, не углубляясь в другие функции

Реат можнт работать в разных режимах, они имеются контекстом. Для разных режимов заведено 6 или 7 позиций бинарного числа. 21152 - строка, где объявляются контексты. Отсутствие контекста - ноль (NoContext). 

executionContext &= ~BatchedContext //  из текущего executionContext исключается BatchedContext
executionContext |= LegacyUnbatchedContext // добавляет LegacyUnbatchedContext в executionContext

Мы отслеживаем состояние момента выполнения программы через битовую маску.

update - инструкция/информация алгоритму реконсилиации для выращивание fiber дерева, которое потом првератится в DOM.

В фазе реконсилиации есть 2 процесса для каждого файбера: beginWork & completeWork. 

Перед тем, как начанется фаза реконсилиации клонируется HostROOT.

Есть baseState, который с update.queue производит операции над state, update, props. Как, пока не понятно.

Update next (как и итератор) указывает на следующий update. Ссылка next самого последнего update указывает на самый первый из этой очереди. 

У любого fiberNode есть по пути updateQueue.shared.pending есть ссылка на самый последний update в очереди.

!!! Требует уточнения. Со слов Абрамова pushHostRootContext нужен для того, чтобы ориентироваться, находимся ли мы в svg.
